---
layout: post
title: "코드리뷰 지적사항으로 배운 것들(작성 중)"
date: 2020-03-13 22:36:00 +0900
categories: [java]
---

## 코드리뷰 지적사항으로 배운 것들 (작성 중)

BaseCamp기간동안 수시로 코드리뷰를 받았습니다.
기본적이지만, 잊지말아야겠다고 생각한 점을 담고 싶어서 이 글을 남깁니다.

<br>

### 코드를 작성할 때, 마음가짐

> 코드도 결국에는 하나의 문서이다. 작성한 문서를 다른 사람이 읽었을 때에도 쉽게 읽을 수 있게 해야한다.
> 그래야 문서를 수정해야 하는 소요가 발생할 때에도 쉽게 찾고, 읽을 수 있을테니까.
> 개발자라면, 초기 개발도 중요하지만, 그만큼 운영할 때의 비용이 많이 드는 부분인 유지보수도 고려해야 한다.

<br>

### 1. 동시성 이슈를 생각할 것

Spring은 동시성에 대한 처리를 개발자에게 위임하고 있다.

- Spring Bean(@Controller, @Service 등)은  Singleton 객체로 존재하지만, Thread-Safety를 보장하지 않는 것은 아니다.
- Singleton객체 안에서 멤버변수를 선언해버리면, 해당 멤버변수는 여러 스레드에 의해 계속해서 상태가 변할 것이다. 즉, 다양한 사용자에 의해서 상태 값이 변동되고, 실행의 순서가 보장되지 않는다.
- Spring Bean 내에서는 멤버변수로 일반적인 변수가 아닌, 다른 Bean객체와 같은 불변객체로 가지고 있는 경우에는, Thread-Safety가 보장된다.

<br>

### 2. 네이밍을 중요시하게 생각할 것

- Boolean형 인자를 반환하는 메소드명은 `is~`, `has~`, `can~` 등을 사용해서 Yes/No로 끝나는 의미를 전달한다.
- 객체지향에서 메소드 명은 `행위` + `대상`(doSomething)형태로 네이밍한다.
- 이 때, 메소드명은 실제 메소드가 내부적으로 어떻게 구현되어 있는지 확인하지 않아도, 이해가 가고, 잘 읽힐 수 있도록 네이밍한다.

- 메소드 네이밍은 해당 메소드를 사용하는 사용자의 입장에서 작성한다.

<br>

### 3. DB, Web 기술 등 인프라에 의존적인 코드를 깊은 Layer에 담지말 것

- 가장 좋은 것은 인프라에 의존하지 않는 코드를 만드는 것이다.
- 예를 들면, Scheduler Service가 있다.
- DB에서 유효기간이 만료된 파일을 주기적으로 삭제해야하는 경우, `MySql`의 `event scheduler`를 이용하여 구현할수도 있다. 
- 하지만, 위와 같이 구현할 경우 다른 사람이 코드를 변경해야할 경우, 해당 코드를 찾기위해서 MySql의 프로시져까지 확인해야 파악할 수 있다. 또한, `MySql`이라는 특정 DB에 의존하는 코드는 나중에 DB를 바꾸게 되었을 때, 코드를 변경해야될 소요가 생긴다.
- Web에 의존하는 기술인 Cookie는 Service Layer가 아닌 Controller 단에서 사용한다.

<br>

### 4. Controller, Service, Mapper, Util 등의 기능을 철저히 분리할 것

- Controller: Client의 요청을 받고, 요청에 대한 응답을 처리한다. 데이터를 잘 만들어줘서, Service Layer에 전달한다. (Parsing의 역할도 수행), 최대한 가볍게 한다.
- Service: 실질적인 비즈니스 Service를 수행한다.
- Mapper: DAO를 받아서, 실제 DB에 저장한다.
- Util: RestTemplate 객체 등 재사용성이 높은 객체에 대해서 Util을 Bean으로 등록하여 사용한다.

<br>

### 5. VO를 DAO와 DTO의 개념으로 나눌 것

- 원래 지적을 받은 내용은 하나의 God Object로 여러 목적으로 사용을 하고 있어서 문제가 발생한 것이었다.
- DAO는 Data Access Object로, DB에 저장할 때, Mapper로 넘겨주는 객체, DB에서 가져올 때, Mapper에서 받아오는 객체이다.
- DTO는 Data Transfer Object로, Controller가 View에 전달해주는 객체이다.
- 비슷한 기능에 따라서 같은 Object를 써도 될 것 같지만, 목적에 따라서 다양한 Object를 사용해야 한다. 
- 예를 들어, 메일 조회를 생각해보면, 메일 목록 조회용과 메일 상세 내용 조회용 객체는 서로 다른 변수를 가지고 있어야 한다.

<br>

### 6. 관심사를 분리할 것

- 메일 쓰기에 대해서 메일을 전송할 때와 파일을 함께 전송하는데, 파일에 대한 처리와 메일에 대한 처리를 동시에 하지 않는다. 왜냐하면, 관심사 분리가 되지 않으면, 메일 전송 중에 예외 혹은 오류가 발생하면, 어느 부분에서 예외 혹은 오류가 발생했는지 정확하지 않고, 이에 대한 처리 또한 복잡해진다.

<br>

### 7. Exception에 대해서 정확하게 처리할 것

- throws Exception으로 계속 호출하는 메소드에 Exception에 대한 처리를 위임시키면 안된다.
- 계속 그런 식으로 직접 처리를 미루다 보면, 결국 호출하는 메소드에 부담을 주는 것이다.
- 그렇다고, try ~ catch로 Exception을 먹어버리고, 처리하지 않는 것은 더욱더 위험하다. 호출하는 메소드 입장에서는 응답도 없고, 처리도 정확하게 되지 않으니, 원인이 무엇인지 파악할 수 없다.

<br>

 베이스캠프가 얼마 남지 않아 제가 기억하고 있는 것을 기록으로 남겨두고 싶어 다소 두서가 없을 수도 있습니다. 추후에, 위 내용은 추가 및 보완될 예정입니다. 댓글로 지적해주신다면, 언제든 수정하겠습니다.

